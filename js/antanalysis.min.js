(function(b, a) {
	if(typeof exports === "object") {
		module.exports = a()
	} else {
		if(typeof define === "function" && define.amd) {
			define(a)
		} else {
			b.NTESAntAnalysis = a()
		}
	}
})(this, function() {
	function x() {
		function L(S) {
			var Q = "";
			var T;
			for(T = 0; T < S.length; T++) {
				var R = S.charCodeAt(T);
				var P = "";
				if(R > 255) {
					while(R >= 1) {
						P = "0123456789".charAt(R % 10) + P;
						R = R / 10
					}
					if(P == "") {
						P = "0"
					}
					P = "#" + P;
					P = "&" + P;
					P = P + ";";
					Q += P
				} else {
					Q += S.charAt(T)
				}
			}
			return Q
		}
		var F = 8;
		var A = 0;

		function z(P) {
			return O(I(y(P), P.length * F))
		}

		function I(P, U) {
			P[U >> 5] |= 128 << ((U) % 32);
			P[(((U + 64) >>> 9) << 4) + 14] = U;
			var Q = 1732584193;
			var R = -271733879;
			var S = -1732584194;
			var T = 271733878;
			for(var X = 0; X < P.length; X += 16) {
				var V = Q;
				var W = R;
				var Y = S;
				var Z = T;
				Q = G(Q, R, S, T, P[X + 0], 7, -680876936);
				T = G(T, Q, R, S, P[X + 1], 12, -389564586);
				S = G(S, T, Q, R, P[X + 2], 17, 606105819);
				R = G(R, S, T, Q, P[X + 3], 22, -1044525330);
				Q = G(Q, R, S, T, P[X + 4], 7, -176418897);
				T = G(T, Q, R, S, P[X + 5], 12, 1200080426);
				S = G(S, T, Q, R, P[X + 6], 17, -1473231341);
				R = G(R, S, T, Q, P[X + 7], 22, -45705983);
				Q = G(Q, R, S, T, P[X + 8], 7, 1770035416);
				T = G(T, Q, R, S, P[X + 9], 12, -1958414417);
				S = G(S, T, Q, R, P[X + 10], 17, -42063);
				R = G(R, S, T, Q, P[X + 11], 22, -1990404162);
				Q = G(Q, R, S, T, P[X + 12], 7, 1804603682);
				T = G(T, Q, R, S, P[X + 13], 12, -40341101);
				S = G(S, T, Q, R, P[X + 14], 17, -1502002290);
				R = G(R, S, T, Q, P[X + 15], 22, 1236535329);
				Q = C(Q, R, S, T, P[X + 1], 5, -165796510);
				T = C(T, Q, R, S, P[X + 6], 9, -1069501632);
				S = C(S, T, Q, R, P[X + 11], 14, 643717713);
				R = C(R, S, T, Q, P[X + 0], 20, -373897302);
				Q = C(Q, R, S, T, P[X + 5], 5, -701558691);
				T = C(T, Q, R, S, P[X + 10], 9, 38016083);
				S = C(S, T, Q, R, P[X + 15], 14, -660478335);
				R = C(R, S, T, Q, P[X + 4], 20, -405537848);
				Q = C(Q, R, S, T, P[X + 9], 5, 568446438);
				T = C(T, Q, R, S, P[X + 14], 9, -1019803690);
				S = C(S, T, Q, R, P[X + 3], 14, -187363961);
				R = C(R, S, T, Q, P[X + 8], 20, 1163531501);
				Q = C(Q, R, S, T, P[X + 13], 5, -1444681467);
				T = C(T, Q, R, S, P[X + 2], 9, -51403784);
				S = C(S, T, Q, R, P[X + 7], 14, 1735328473);
				R = C(R, S, T, Q, P[X + 12], 20, -1926607734);
				Q = N(Q, R, S, T, P[X + 5], 4, -378558);
				T = N(T, Q, R, S, P[X + 8], 11, -2022574463);
				S = N(S, T, Q, R, P[X + 11], 16, 1839030562);
				R = N(R, S, T, Q, P[X + 14], 23, -35309556);
				Q = N(Q, R, S, T, P[X + 1], 4, -1530992060);
				T = N(T, Q, R, S, P[X + 4], 11, 1272893353);
				S = N(S, T, Q, R, P[X + 7], 16, -155497632);
				R = N(R, S, T, Q, P[X + 10], 23, -1094730640);
				Q = N(Q, R, S, T, P[X + 13], 4, 681279174);
				T = N(T, Q, R, S, P[X + 0], 11, -358537222);
				S = N(S, T, Q, R, P[X + 3], 16, -722521979);
				R = N(R, S, T, Q, P[X + 6], 23, 76029189);
				Q = N(Q, R, S, T, P[X + 9], 4, -640364487);
				T = N(T, Q, R, S, P[X + 12], 11, -421815835);
				S = N(S, T, Q, R, P[X + 15], 16, 530742520);
				R = N(R, S, T, Q, P[X + 2], 23, -995338651);
				Q = D(Q, R, S, T, P[X + 0], 6, -198630844);
				T = D(T, Q, R, S, P[X + 7], 10, 1126891415);
				S = D(S, T, Q, R, P[X + 14], 15, -1416354905);
				R = D(R, S, T, Q, P[X + 5], 21, -57434055);
				Q = D(Q, R, S, T, P[X + 12], 6, 1700485571);
				T = D(T, Q, R, S, P[X + 3], 10, -1894986606);
				S = D(S, T, Q, R, P[X + 10], 15, -1051523);
				R = D(R, S, T, Q, P[X + 1], 21, -2054922799);
				Q = D(Q, R, S, T, P[X + 8], 6, 1873313359);
				T = D(T, Q, R, S, P[X + 15], 10, -30611744);
				S = D(S, T, Q, R, P[X + 6], 15, -1560198380);
				R = D(R, S, T, Q, P[X + 13], 21, 1309151649);
				Q = D(Q, R, S, T, P[X + 4], 6, -145523070);
				T = D(T, Q, R, S, P[X + 11], 10, -1120210379);
				S = D(S, T, Q, R, P[X + 2], 15, 718787259);
				R = D(R, S, T, Q, P[X + 9], 21, -343485551);
				Q = E(Q, V);
				R = E(R, W);
				S = E(S, Y);
				T = E(T, Z)
			}
			return Array(Q, R, S, T)
		}

		function B(P, S, T, U, Q, R) {
			return E(M(E(E(S, P), E(U, R)), Q), T)
		}

		function G(T, U, P, Q, V, R, S) {
			return B((U & P) | ((~U) & Q), T, U, V, R, S)
		}

		function C(T, U, P, Q, V, R, S) {
			return B((U & Q) | (P & (~Q)), T, U, V, R, S)
		}

		function N(T, U, P, Q, V, R, S) {
			return B(U ^ P ^ Q, T, U, V, R, S)
		}

		function D(T, U, P, Q, V, R, S) {
			return B(P ^ (U | (~Q)), T, U, V, R, S)
		}

		function E(Q, R) {
			var S = (Q & 65535) + (R & 65535);
			var P = (Q >> 16) + (R >> 16) + (S >> 16);
			return(P << 16) | (S & 65535)
		}

		function M(Q, P) {
			return(Q << P) | (Q >>> (32 - P))
		}

		function y(R) {
			var S = new Array();
			var Q = (1 << F) - 1;
			for(var P = 0; P < R.length * F; P += F) {
				S[P >> 5] |= (R.charCodeAt(P / F) & Q) << (P % 32)
			}
			return S
		}

		function O(S) {
			var P = A ? "0123456789ABCDEF" : "0123456789abcdef";
			var R = "";
			for(var Q = 0; Q < S.length * 4; Q++) {
				R += P.charAt((S[Q >> 2] >> ((Q % 4) * 8 + 4)) & 15) + P.charAt((S[Q >> 2] >> ((Q % 4) * 8)) & 15)
			}
			return R
		}
		var H = new Date();
		var J = document.body.clientWidth + ":" + document.body.clientHeight;
		var K = L(H.getTime() + document.location + screen.width + screen.height + navigator.userAgent + Math.random() + J);
		return z(K)
	}

	function w(E) {
		var z = document.cookie;
		var D = E + "=";
		var A = z.length;
		var y = 0;
		while(y < A) {
			var C = y + D.length;
			if(z.substring(y, C) == D) {
				var B = z.indexOf(";", C);
				if(B == -1) {
					B = A
				}
				return unescape(z.substring(C, B))
			}
			y = z.indexOf(" ", y) + 1;
			if(y == 0) {
				break
			}
		}
		return -1
	}

	function i(y, z) {
		document.cookie = y + "=" + z + "; expires=-1" + "; path=/; domain=" + document.domain
	}

	function n() {
		return(/baiduspider/ig).test(navigator.userAgent)
	}

	function e(z) {
		if(!z) {
			return z
		}
		for(var y = 1, B = arguments.length; y < B; y++) {
			var C = arguments[y];
			if(C) {
				for(var A in C) {
					if(typeof z[A] == "undefined") {
						z[A] = C[A]
					}
				}
			}
		}
		return z
	}

	function p() {
		var C = window.location.href;
		var D = C.split("?")[1];
		var B = {};
		if(D) {
			var z, y = D.split("&");
			for(z = 0; z < y.length; z++) {
				var A = y[z].split("=");
				B[A[0]] = A[1]
			}
		}
		return B
	}

	function o(B, y) {
		var z = w(B),
			A = w(y);
		return z == -1 ? A == -1 ? "" : A : z
	}

	function m() {
		var z = "https://c.m.163.com/nc/qa/uid.html";
		var y = document.createElement("iframe");
		y.setAttribute("src", z);
		y.setAttribute("width", 0);
		y.setAttribute("height", 0);
		y.setAttribute("tabindex", -1);
		y.setAttribute("style", "display:none;");
		y.setAttribute("class", "ntesanalysis-sync-iframe");
		document.body.insertBefore(y, document.body.children[0])
	}
	var u = navigator.userAgent;
	var b = document.referrer;
	var h;
	var j = p();
	var r, q;
	var v = (j.spss) ? j.spss : ((u.match(/newsapp/gi)) ? "native" : (document.referrer.match(/163.com/gi)) ? "163" : "other");

	function t() {
		j.title = document.title;
		j.currentURL = document.location.href;
		j.referrerURL = document.referrer;
		window.addEventListener("message", function(y) {
			if(!y.origin.match("c.m.163.com")) {
				return
			}
			h = y.data.ntesSpsuid
		}, false);
		document.addEventListener("DOMContentLoaded", function(y) {
			m()
		});
		r = l();
		q = c()
	}
	t();

	function l() {
		if(!r) {
			if(w("_ntes_nuid") == -1) {
				r = h
			} else {
				r = w("_ntes_nuid");
				try {
					window.localStorage.setItem("ntesSpsuid", r)
				} catch(z) {
					console.log(z.message, z.name, z.stack)
				}
			}
			var y = "";
			try {
				y = localStorage.getItem("ntesSpsuid")
			} catch(z) {
				console.log(z.message, z.name, z.stack)
			}
			r = r ? r : y;
			if(!r) {
				r = x();
				try {
					window.localStorage.setItem("ntesSpsuid", r)
				} catch(z) {
					console.log(z.message, z.name, z.stack)
				}
			}
		}
		return r
	}

	function c() {
		if(!q) {
			q = parseInt(j.spsw) || 0;
			var y = false;
			if(j.spssid == r) {
				y = true
			}
			if(!y) {
				q = q + 1
			}
		}
		return q
	}

	function g(D) {
		var C = {};
		var z = "";
		if(u.match(/micromessenger/gi)) {
			z = (j.from) ? "wx:" + j["from"].split("#")[0] : "wx"
		} else {
			if(u.match(/weibo/gi)) {
				z = "wb"
			} else {
				if(u.match(/yixin/gi)) {
					z = "yx"
				} else {
					if(u.match(/qq/gi)) {
						z = "qq"
					} else {
						if(u.match(/newsapp/gi)) {
							z = "newsapp"
						} else {
							if(b.match(/weibo\.com/)) {
								z = "wb"
							} else {
								if(b.match(/qq\.com/) || b.match(/qzone\.com/)) {
									z = "qq"
								}
							}
						}
					}
				}
			}
		}
		var B = w("_antanalysis_s_id");
		if(B == -1) {
			var y = new Date().getTime();
			i("_antanalysis_s_id", y);
			B = y
		}
		C = {
			sdk_ver: "1.22",
			session_id: B,
			ct: z,
			source: v,
			uuid: r,
			channel: j.spsc ? j.spsc : "",
			val_act: "",
			val_url: window.location.href,
			uid: o("P_INFO", "P_OINFO").split("|")[0],
			uname: "",
			val_ref: j.referrerURL,
			sc: screen.width + "*" + screen.height,
			info: {
				spstitle: j.title,
				spssid: j.spssid ? j.spssid : "",
				spsw: parseInt(j.spsw) ? parseInt(j.spsw) : 0
			}
		};
		if(D && D.info) {
			D.info = e(C.info, D.info)
		}
		var A = e(D, C);
		if(A.callback) {
			delete A.callback
		}
		window.params = A;
		return A
	}

	function a(D) {
		D.tm = new Date().getTime();
		var C = encodeURIComponent(JSON.stringify(D));
		var z = "http:";
		if(window.location.protocol == "https:") {
			z = "https:"
		}
		var A = z + "//h5.analytics.126.net/news/c?" + C;
		var B = "ntes_ant_" + new Date().getTime();
		var y = window[B] = new Image();
		y.src = A
	}

	function f(z) {
		var B = "";
		var y = ["spssid", "spsw", "spss", "spsc"];
		var A;
		for(A = 0; A < y.length; A++) {
			if((z.indexOf(y[A]) == -1) && (j[y[A]])) {
				B += y[A] + "=" + j[y[A]]
			}
			if((A != y.length - 1) && !!B) {
				B += "&"
			}
		}
		if(!!B) {
			if(z.indexOf("?") != -1) {
				z += "&" + B
			} else {
				z += "?" + B
			}
		}
		return z
	}

	function k(B) {
		if(B) {
			B = f(B)
		}
		var y = "";
		var D = B || window.location.href;
		var E = false;
		if(D.indexOf("?") != -1) {
			var z = D.split("?");
			var F = z[1].match(/spssid=\w+/g);
			if(F) {
				y = z[1].replace(/spssid=\w+/g, "spssid=" + r)
			} else {
				y = "&spssid=" + r + "&" + z[1]
			}
			var C = y.match(/spsw=\d+/g);
			if(C) {
				y = y.replace(/spsw=\d+/g, "spsw=" + q)
			} else {
				y = "spsw=1" + y
			}
			var C = y.match(/spss=\w+/g);
			if(!C) {
				y = "?spss=" + v + "&" + y
			} else {
				y = "?" + y
			}
			y = z[0] + y
		} else {
			var A = D.split("#");
			if(A[1]) {
				y = A[0] + "?spssid=" + r + "&spsw=1" + "&spss=" + v + "#" + A[1]
			} else {
				y = A[0] + "?spssid=" + r + "&spsw=1" + "&spss=" + v
			}
		}
		return y
	}

	function d(A) {
		if(n()) {
			return
		}
		var y = A.callback;
		var z = g(A);
		a(z);
		(A && y) ? y(): ""
	}
	var s = {
		sendData: d,
		getShareLink: k,
		info: {
			uid: l(),
			spsuid: l(),
			spsw: c()
		}
	};
	return s
});